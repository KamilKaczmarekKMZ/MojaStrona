<!DOCTYPE html>
<html lang="en">
<head>
    <title>Three.js Torus Knot Demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
        }
        #info {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 14px;
            background-color: rgba(0,0,0,0.5);
            padding: 5px;
            z-index: 100;
        }
        #info a {
            color: #4cc9f0;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div id="info">
        <a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> - Torus Knot Demo
    </div>

    <!-- Wersje CDN -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/lil-gui.module.min.js"></script>

    <script>
        // Parametry
        const params = {
            autoRotate: true,
            metalness: 1.0,
            roughness: 0.0,
            exposure: 1.0,
            color: '#ffffff'
        };

        // Inicjalizacja sceny
        let renderer, scene, camera, controls, torusMesh;

        init();

        function init() {
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = params.exposure;
            document.body.appendChild(renderer.domElement);

            // Scena
            scene = new THREE.Scene();

            // Obiekt - Torus Knot
            torusMesh = new THREE.Mesh(
                new THREE.TorusKnotGeometry(1, 0.4, 128, 32),
                new THREE.MeshStandardMaterial({ 
                    color: new THREE.Color(params.color),
                    roughness: params.roughness,
                    metalness: params.metalness,
                    envMapIntensity: 1.0
                })
            );
            scene.add(torusMesh);

            // Kamera
            camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 5);

            // Kontrola orbit
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Oświetlenie
            const light1 = new THREE.DirectionalLight(0xffffff, 1);
            light1.position.set(1, 1, 1);
            scene.add(light1);

            const light2 = new THREE.AmbientLight(0x404040);
            scene.add(light2);

            // Ładowanie tekstury środowiska
            new THREE.RGBELoader()
                .setDataType(THREE.UnsignedByteType)
                .load('https://threejs.org/examples/textures/equirectangular/venice_sunset_1k.hdr', function(texture) {
                    texture.mapping = THREE.EquirectangularReflectionMapping;
                    scene.environment = texture;
                    scene.background = texture;
                }, undefined, function(error) {
                    console.error('Error loading HDR:', error);
                    // Fallback - kolor tła
                    scene.background = new THREE.Color(0x333333);
                });

            // GUI
            const gui = new GUI();
            gui.add(params, 'autoRotate');
            gui.add(params, 'metalness', 0, 1, 0.01);
            gui.add(params, 'roughness', 0, 1, 0.01);
            gui.add(params, 'exposure', 0, 4, 0.01);
            gui.addColor(params, 'color').onChange(function(value) {
                torusMesh.material.color.set(value);
            });
            gui.open();

            // Resize handler
            window.addEventListener('resize', onWindowResize);

            // Rozpocznij animację
            animate();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (params.autoRotate) {
                torusMesh.rotation.y += 0.005;
            }

            controls.update();
            renderer.toneMappingExposure = params.exposure;
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
